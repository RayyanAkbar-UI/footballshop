{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Login - Football Shop</title>
{% endblock meta %}

{% block content %}
<div class="container">
    <div class="min-h-[calc(100vh-10rem)] flex items-center justify-center">
        <div class="w-full max-w-md">
            <div class="glass rounded-xl p-6">
                <h1 class="text-2xl font-bold mb-6 neural-glow text-center">Login</h1>

                <form id="loginForm" class="space-y-4">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    
                    <div id="error-message" class="text-red-400 text-sm hidden">
                        <!-- Error messages will appear here -->
                    </div>
                    
                    <button type="submit" id="loginButton" class="action-link w-full bg-purple-900/20 hover:bg-purple-900/30 py-3 mt-4">
                        Login
                    </button>
                </form>

                <p class="mt-4 text-center text-sm opacity-70">
                    Don't have an account?
                    <a href="{% url 'main:register' %}" class="text-purple-400 hover:text-white transition">
                        Register here
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const loginButton = document.getElementById('loginButton');
    const errorMessage = document.getElementById('error-message');
    
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Disable button and show loading state
        loginButton.disabled = true;
        loginButton.innerHTML = '<span class="animate-pulse">Logging in...</span>';
        errorMessage.classList.add('hidden');
        
        const formData = new FormData(loginForm);
        
        fetch("{% url 'main:login_ajax' %}", {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status) {
                // Success
                showToast('Login Successful', `Welcome back, ${data.username}!`, 'success');
                setTimeout(() => {
                    window.location.href = "{% url 'main:show_main' %}";
                }, 1000);
            } else {
                // Error
                errorMessage.textContent = data.message;
                errorMessage.classList.remove('hidden');
                loginButton.disabled = false;
                loginButton.textContent = 'Login';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            errorMessage.textContent = 'Something went wrong. Please try again.';
            errorMessage.classList.remove('hidden');
            loginButton.disabled = false;
            loginButton.textContent = 'Login';
        });
    });
});
</script>
{% endblock content %}
